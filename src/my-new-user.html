<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">

<dom-module id="my-new-user">
  <template>
    <style>
      :host {  /* Para referenciar el estilo de mi componente */
        display: inline-block;
        background-color: red; <!-- Indico color de fondo para diferenciar area del compoennte -->
      }
    </style>

    <!-- Metemos parte para interactuar con MongoDB -->
    <div><span>Fill the new user info:</span></div>
    <div>
      Name:
      <input type="text" name="nameInput"/>
      <p>
      Email:
      <input type="text" name="emailInput"/>
      <p>
      Password:
      <input type="text" name="passwordInput"/>
    </div>

    <div><button type="button" name="btnNewUser" on-click="postNewUser">AÃ±adir post a MongoDB</button></div>
    <p>
  </template>

  </template>
    <script>
      Polymer({
        is: 'my-new-user',
        properties: {
          url: {
            type: String,
            value: "http://postgrebc9688.cloudapp.net:3000/api/usuarios"
          },
          posts: {
            type: Array,
          }
        },
        listeners: {
        },
        postNewUser: function() {
          var name = document.getElementsByName("nameInput")[0].value;
          var email = document.getElementsByName("emailInput")[0].value;
          var password = document.getElementsByName("passwordInput")[0].value;
          console.log("Name: " + name + ", Email: " + email + ", Password: " + password);
          var peticion = new XMLHttpRequest();
          peticion.open("POST", this.url, true);
          peticion.setRequestHeader("Content-Type", "application/json");
          peticion.send('{"nombre":"' + name + '", "email": "' + email + '", "password":"' + password + '"}');
        },
        obtenerPosts: function() {
          var peticion = new XMLHttpRequest();
          peticion.open("GET", this.url + this.apiKey, false);
          peticion.setRequestHeader("Content-Type", "application/json");
          peticion.send();
          this.posts = JSON.parse(peticion.responseText);
          sessionStorage["posts"] = peticion.responseText;
          console.log("ROD: " + peticion.responseText);
        },
        borrarPosts: function(id) {
          var peticion = new XMLHttpRequest();
          var URLItem = "https://api.mlab.com/api/1/databases/dbbootcamp/collections/posts/";
          URLItem += id;
          URLItem += this.apiKey;
          console.log("Procedemos a borrar el post con id: " + id);
          peticion.open("DELETE", URLItem, false);
          peticion.setRequestHeader("Content-Type", "application/json");
          peticion.send();
          console.log("El post con id: " + id + " ha sido borrado");
        }
      })
    </script>
</dom-module>
