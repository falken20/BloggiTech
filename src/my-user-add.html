<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="shared-styles.html">

<dom-module id="my-user-add">
  <template>
    <style>
      :host {  /* Para referenciar el estilo de mi componente */
        display: inline-block;
        background-color: white;
        width: -moz-available;
        align-items: center;
      }
    </style>

    <!-- Metemos parte para interactuar con MongoDB -->
    <div class="container">
      <div class="login-container">
                <div id="output"></div>
                <div class="avatar"><img src="https://cdn2.iconfinder.com/data/icons/blue-rounded-set/154/avatar-login-round-profile-512.png" width="95px" height="95px"></div>
                <div><span></span></div>
                <div class="form-box">
                    <form action="" method="">
                        Name: <input name="usernameInput" type="text" placeholder="username" maxlength="20" size="100" style="margin-top:1px">
                        eMail: <input name="emailInput" type="text" placeholder="email" maxlength="30" data-validation="email" style="margin-top:1px">
                        Password: <input name="passwordInput" type="password" placeholder="password" maxlength="20" style="margin-top:1px">
                        <button class="btn btn-info btn-block login" type="button" name="btnAddNewUser" on-click="addNewUser">Register</button>
                    </form>
                </div>
                <div><span id="mensaje"></span></div>
            </div>
  </template>

    <script>
      Polymer({
        is: 'my-user-add',
        properties: {
          url: {
            type: String,
            value: "http://postgrebc9688.cloudapp.net:3000/api/usuarios"
          }
        },
        listeners: {
        },
        addNewUser: function() {
          var username = document.getElementsByName("usernameInput")[0].value;
          var email = document.getElementsByName("emailInput")[0].value;
          var password = document.getElementsByName("passwordInput")[0].value;
          console.log("ROD: Adding user -> Name: " + username + ", Email: " + email + ", Password: " + password);
          var peticion = new XMLHttpRequest();
          peticion.open("POST", this.url, false);
          peticion.setRequestHeader("Content-Type", "application/json");
          peticion.setRequestHeader("Access-Control-Allow-Origin", "*");
          peticion.send('{"nombre":"' + username + '", "email": "' + email + '", "password":"' + password + '"}');
          var spanMensaje = document.getElementById("mensaje");
          var respuesta = JSON.parse(peticion.responseText);
          if (peticion.status=="200")
          {
              console.log("ROD: User " + username + " added");
              sessionStorage.setItem("usuario", username);
              spanMensaje.innerText = "Usuario creado correctamente";
          }
          else 
          {
              spanMensaje.innerText = "No se pudo crear el usuario";
          }
        }
      })
    </script>
</dom-module>
